---
layout: post
title: "WebDeploy auf Azure Websites über die Kommandozeile"
date: 2013-06-30 22:47
author: robert.muehsig
comments: true
categories: [HowTo]
tags: [Azure Websites, WebDeploy]
---
{% include JB/setup %}
<p>Das Deployment von ASP.NET Anwendung auf Azure Websites ist im Visual Studio sehr einfach gemacht. Im neusten Azure SDK kann man seine Azure Subscription importieren und direkt die bereits angelegte Azure Website als Deployment-Ziel auswählen:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1864.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb1008.png" width="544" height="431"></a>&nbsp;</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1865.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb1009.png" width="553" height="440"></a> </p> <p>Die Deployment-Daten werden in eine .pubxml Datei im Projekt abgelegt. Dieses enthält alle Daten – <strong>bis auf das Passwort</strong>.</p> <p>Visual Studio legt dieses Passwort irgendwo anders ab. Allerdings ist es ohnehin kein sauberer Prozess wenn man nur aus dem Visual Studio heraus deployed. Ein schönerer Weg wäre, dass ein Build-System das WebDeploy Package baut und man hinterher das Projekt auf eine beliebige Azure Website oder einem lokalen IIS veröffentlichen kann.</p> <h3>Wie veröffentlicht man ein WebDeploy Package über die CMD?</h3> <p>Wer z.B. sich <a href="http://code-inside.de/blog/2010/11/11/howto-msdeploy-msbuild/">über MSBuild ein WebDeploy Package</a> bauen lässt, der bekommt neben dem eigentlichen Package auch eine Batch-Datei über den man den Prozess starten kann.</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1866.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb1010.png" width="521" height="127"></a> </p> <p>Wer die Datei so aufruft der bekommt bereits eine ReadMe Datei zu sehen. Wichtig für Azure Websites: Zum Deployen benötigt man aber das Passwort!</p> <h3>Wo finde ich das WebDeploy Passwort für Azure Websites?</h3> <p>Die einzig mir bekannte Möglichkeit das WebDeploy Passwort zu bekommen ist sich das Publishing-Profile über das Web-Management-Tool runterzuladen. Das WebDeploy Passwort hat auch nichts mit dem FTP/Git-Passwort zutun, welches man extra noch setzen kann!</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1867.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb1011.png" width="501" height="341"></a> </p> <p>In dieser Datei steht auch unverschlüsselt das kryptisch anmutende Passwort:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1868.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb1012.png" width="530" height="83"></a> </p> <h3><strong>TL;DR - Der CMD Befehl:</strong></h3> <p>In meinem Beispiel sieht es so aus:</p><pre>WebDeployPackage.deploy.cmd /y "/m:https://waws-prod-am2-001.publish.azurewebsites.windows.net/MsDeploy.axd?Site=blogpostsample" -allowUntrusted /u:"$blogpostsample" /p:"AssmJvtBrcWqfjaoHiANseLfyLuyJ1zyMn44L8YGQNKLCA9Rd9CZesxe9ilJ" /a:Basic</pre>
<p>Angepasst muss allerdings die <strong>URL (/m:)</strong> (diese ändert sich je nach Region), die <strong>Seite</strong>, das <strong>Passwort (/p:)</strong> und der <strong>User (/u:)</strong>. Die Daten sind alle in dem Publishing-Profil enthalten.</p>
<p>Zusätzlich muss in der SetParameters.xml Datei der IIS App Name angepasst werden:</p>
<p></p><pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;<br>&lt;parameters&gt;<br>&nbsp; &lt;setParameter name="IIS Web Application Name" value="blogpostsample" /&gt;<br>&lt;/parameters&gt;</pre>
<p></p>
<p>Damit sollte man jetzt in der Lage sein über die Kommandozeile und ohne weitere Tools direkt auf Azure Websites zu deployen.</p>
<p>Quelle:</p>
<p>Ich bin über <a href="http://blog.greatrexpectations.com/2013/02/02/publish-an-azure-web-site-from-the-command-line/">diesen Blogpost</a> auf die Lösung gekommen – nachdem ich bereits <a href="http://stackoverflow.com/questions/16433911/deploy-azure-website-via-msbuild-webdeploy-but-with-which-credentials">auf Stackoverflow selbst die Frage</a> gestellt hatte.</p>
