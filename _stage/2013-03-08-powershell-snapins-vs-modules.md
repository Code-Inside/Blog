---
layout: post
title: "PowerShell SnapIns vs. Modules"
date: 2013-03-08 16:54
author: antje.kilian
comments: true
categories: [Uncategorized]
tags: []
language: en
---
{% include JB/setup %}
<p>Powershell offers to ways to expand CmdLet’s or Providers: SnapIns and Modules. But what is the difference?</p> <p><strong>TL;DR:</strong></p> <p><strong></strong></p> <table cellspacing="0" cellpadding="0" border="0"> <tbody> <tr> <td valign="top" width="201"><strong>Snapins</strong><strong> </strong></td> <td valign="top" width="200"><strong>Modules</strong><strong> </strong></td></tr> <tr> <td valign="top" width="201">Model from PS 1.0 Variante – “old”</td> <td valign="top" width="200">Introduced with PS 2.0</td></tr> <tr> <td valign="top" width="201">Defined in Assemblies</td> <td valign="top" width="200">Defined in Assemblies or in Scripts</td></tr> <tr> <td valign="top" width="201">Complex deployment via Installutil</td> <td>Moduls in the file system</td></tr></tbody></table> <p>&nbsp;</p> <p><strong>Snapins: the old way</strong></p> <p>Snapins (like for example WebAdministration PSSnapin in the era of Windows Server 2008) are the old way which could be used in the first version of Powershell.</p> <p>Disadvantages of this method:</p> <p>- The PSSnapins have to be written in a .NET language and have to be available as an Assembly (there are some <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms714437(v=vs.85).aspx">Sample Codes for the production of PSSnapIns in MSDN</a>)</p> <p>- The Assemblies have to be installed with a <a href="http://msdn.microsoft.com/en-us/library/50614e95(v=vs.110).aspx">installutil.exe</a></p> <p><strong></strong></p> <p>&nbsp;</p> <p><strong>What PSSnapins are installed on my system?</strong></p> <p>You will find all installed Snapins on the CmdLet “Get-PSSnapin-registered”:</p> <p><a href="{{BASE_PATH}}/assets/wp-images-en/image1766.png"><img title="image1766" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image1766" src="{{BASE_PATH}}/assets/wp-images-en/image1766_thumb.png" width="531" height="93"></a></p> <p><strong></strong></p> <p>&nbsp;</p> <p><strong>Where are the PSSnapins saved? Of course in the registry!</strong></p> <p>The registration of the PSSnapins happens in the Registry:</p> <p><em>Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PowerShell\1\PowerShellSnapIns\</em></p> <p><img title="image" border="0" alt="image" src="http://code-inside.de/blog/wp-content/uploads/image_thumb921.png" width="530" height="193"><strong> </strong></p> <p><strong></strong></p> <p>&nbsp;</p> <p><strong>What CmdLets are responsible for the administration of the PSSnapins?</strong></p> <p><em>Get-PSSnapIn –registered</em>: delivers all available PSSnapIns<br><em>Add-PSSnapIn [name]:</em><em> </em>adds the PSSnapIn to the PowerShell Session<br><em>Get-Command –pssnapin [name]: </em><em>adds CmdLets to the PSSnapin (has to be added via add to the session in the beginning) </em></p> <p><span style="text-decoration: underline">All in all you should not create Snapins anymore</span> – but they are still in use and therefore this explanation.</p> <p><strong></strong></p> <p>&nbsp;</p> <p><strong>PowerShell modules – the new world</strong></p> <p>The modules get established with the second version of PowerShell and they offer a lot more opportunities without the need for registration in the registry.</p> <p><strong></strong></p> <p><strong>Where are the modules saved?</strong></p> <p>If the only task is to import a module via the module-name with <a href="http://technet.microsoft.com/en-us/library/hh849725.aspx">Import-Module</a> usually it takes a look into the folders which are defined in the environment variable <strong>$env:psmodulepath:</strong></p> <p><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://code-inside.de/blog/wp-content/uploads/image_thumb922.png" width="600" height="60"></p> <p><strong></strong></p> <p>Otherwise it is also possible to <a href="http://blogs.technet.com/b/heyscriptingguy/archive/2012/11/08/powertip-import-a-powershell-module-from-a-shared-location.aspx">define a certain pad to Powershell modules</a> at the <a href="http://technet.microsoft.com/en-us/library/hh849725.aspx">Import-Module</a>.</p> <p>Note: In Powershell 3.0 all available modules are activated automatically in the session and you don’t have to load them with the Import-Module.</p> <p><strong></strong></p> <p>&nbsp;</p> <p><strong>What modules are “installed”?</strong></p> <p>You will find a list on “Get-Module –ListAvailable”:</p> <p><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://code-inside.de/blog/wp-content/uploads/image_thumb923.png" width="583" height="273"></p> <p><strong></strong></p> <p>&nbsp;</p> <p><strong>What is the “ModuleType”?</strong></p> <p>Other then PSSnapins modules can consist of simple scripts, a workflow, an assembly or a manifest. Therefore is the definition of the ModuleType:</p> <p><em>Binary</em><em><br><em>A module whose members are defined within an assembly (</em></em><code>.dll</code><em> </em><em>extension), such as a snap-in or a class library that contains cmdlet classes. This field is introduced in Windows PowerShell 2.0.</em></p> <p><em>Cim</em><em><br><em>A cmdlets-over-objects module (</em></em><code>.cdxml</code><em> </em><em>extension).</em></p> <p><em>Manifest</em><em><br><em>A module that is defined by a module manifest file (</em></em><code>.psd1</code><em> </em><em>extension) whose</em><em> </em><code>ModulesToProcess</code><em>key is empty. This field is introduced in Windows PowerShell 2.0.</em></p> <p><em>Script</em><em><br><em>A module whose members are defined within a script module file (</em></em><code>.psm1</code><em> </em><em>extension). This field is introduced in Windows PowerShell 2.0.</em></p> <p><em>Workflow</em><em><br><em>A workflow module (</em></em><code>.xaml</code><em> </em><em>extension).</em></p> <p>From this <a href="http://msdn.microsoft.com/en-us/library/system.management.automation.moduletype(v=vs.85).aspx">MSDN article</a>.</p> <p>&nbsp;</p> <p><strong>What does such a module look like? Let’s have a look at the “WebAdministration” module</strong></p> <p>The “WebAdministration”-Module (to administrate the IIS) is located in the usual “WindowsPowershell” folder and it contains some files:</p> <p><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="http://code-inside.de/blog/wp-content/uploads/image_thumb924.png" width="546" height="269"></p> <p>The .psd1 file is the <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd878324(v=vs.85).aspx">Module Manifest</a> and in fact what is important:</p><pre class="csharpcode">@{
GUID=<span class="str">'{13c15630-959c-49e4-a977-758c5cc93408}'</span>
Author=<span class="str">'Microsoft Corporation'</span>
CompanyName=<span class="str">'Microsoft Corporation'</span>
Copyright=<span class="str">'© Microsoft Corporation. All rights reserved.'</span>
ModuleVersion=<span class="str">'1.0.0.0'</span>
PowerShellVersion=<span class="str">'3.0'</span>
CLRVersion=<span class="str">'4.0'</span>
TypesToProcess=<span class="str">'iisprovider.types.ps1xml'</span>
FormatsToProcess=<span class="str">'iisprovider.format.ps1xml'</span>
NestedModules=<span class="str">'Microsoft.IIS.PowerShell.Provider.dll'</span>
RequiredAssemblies=<span class="str">'Microsoft.IIS.PowerShell.Framework.dll'</span>
AliasesToExport=<span class="str">'Begin-WebCommitDelay'</span>,<span class="str">'End-WebCommitDelay'</span>
HelpInfoUri=<span class="str">"http://go.microsoft.com/fwlink/?LinkID=216903"</span>
}</pre>
<p><!-- .csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } -->The main functionality of the Powershell module is in the Microsoft.IIS.PowerShell.Provider.dll <a href="http://code-inside.de/blog/2013/02/07/mit-net-4-0-gibt-es-einen-neuen-gac/">CLR 4.0 GAC.</a></p>
<p>&nbsp;</p>
<p><strong>How do I write a Windows Powershell Module? </strong></p>
<p>After all the development of .NET based Powershell Modules is quite similar to the old Snapins:</p>
<p><a href="http://blogs.msdn.com/b/saveenr/archive/2010/03/08/how-to-create-a-powershell-2-0-module-and-cmdlet-with-visual-studio-2010-screencast-included.aspx">How to Create a Powershell 2.0 Module and Cmdlet with Visual Studio 2010 (Screencast included)</a></p>
<p>A good reference is also <a href="https://github.com/WindowsAzure/azure-sdk-tools/tree/master/WindowsAzurePowershell">Windows Azure CmdLets</a>.</p>
<p>&nbsp;</p>
<p><strong>How do I register new modules?</strong></p>
<p>The CmdLets for the registration of modules is also similar to the Snapins:</p><pre class="csharpcode">Get-Module -ListAvailable
Import-Module name
Get-Command -module name</pre>
<p><br><!-- .csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } --></p>
