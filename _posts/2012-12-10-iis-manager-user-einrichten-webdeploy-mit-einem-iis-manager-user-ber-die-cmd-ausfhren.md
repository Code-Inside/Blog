---
layout: post
title: "IIS Manager User einrichten & WebDeploy mit einem IIS Manager User über die CMD ausführen"
date: 2012-12-10 19:42
author: robert.muehsig
comments: true
categories: [HowTo]
tags: [IIS, WebDeploy]
---
{% include JB/setup %}
<p>WebDeploy ist die momentan bevorzugte/modernste Form des Deployments von Webanwendungen auf Microsoft’s Webserver. Wie man das ganze Einrichtet und wie man dies aus dem Visual Studio selbst schnell testen kann habe ich <a href="http://code-inside.de/blog/2012/11/06/setup-iis-8-fr-asp-net-webdeploy-auf-windows-8-und-windows-server-2012/">hier bereits beschrieben</a>. <br>Allerdings ist es einfach nur falsch wenn man das Deployment aus dem Visual Studio ausführt und daher bietet es sich an diesen Prozess zu automatisieren.<br>Ein kleines Problem stellt dann allerdings die Authentifizierung da: Ein Windows Account angeben ist nicht immer möglich (weil nur der Entwickler Account da ist und man sein Passwort nicht in irgendein Script schreiben will etc.) – daher gibt es die IIS Manager User.</p> <p><strong>IIS Management</strong></p> <p>Als Accounts für den Deployment Prozess können Windows Accounts genommen werden oder (dies ist allerdings nur bei IIS Server Installationen möglich) IIS Manager User.</p> <p>Vorteil des extra Users: Der User muss nicht im Active Directory / im Windows selbst angelegt werden und die Gefahr, dass der Account unter umständen übernommen werden könnte und das System übernehmen könnte ist auch nicht vorhanden. Zudem kann man einen speziellen Account nur für das Deployment anlegen, welcher auch nur diese entsprechenden Berechtigungen bekommt. </p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1686.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb844.png" width="573" height="356"></a> </p> <p>In dieser Administrationsoberfläche kann man IIS Manager Users verwalten:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1687.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb845.png" width="577" height="350"></a> </p> <p></p> <p><strong>IIS Manager User Permission vergabe pro Seite</strong></p> <p>Den angelegten Nutzer muss man nun noch die passenden Berechtigungen auf der Seite geben. Dies geht unter dem Punkt “IIS Manager Permissions” auf der entsprechenden IIS Seite:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1688.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb846.png" width="581" height="576"></a> </p> <p>IIS User oder Windows Account auswählen:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1689.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb847.png" width="582" height="316"></a> </p> <p>Damit sollte der IIS Manager für die Seite berechtigt sein und wir können nun über diesen Account das Deployment ausführen.</p> <p><strong>WebDeploy Package über die Kommandozeile ausführen</strong></p> <p>Wer sich ein WebDeploy Package bauen lässt, der bekommt am Ende auch eine Batch Datei mit ausgeliefert – diese hat allerdings einen <a href="http://msdn.microsoft.com/en-us/library/ff356104.aspx">etwas komplexeren Syntax</a>. Diese hat einen etwas komplizierten Syntax und ist nicht richtig hilfreich wenn man einen Fehler macht.</p> <p>Hier also der Aufruf wenn man einen IIS Manager User zum Deployen nutzen möchte:</p> <p>Die Grossbuchstaben sollten entsprechend ersetzt werden.</p><pre>PACKAGE.deploy.cmd /y "/m:https://SERVER:8172/MsDeploy.axd?Site=SITENAME" -allowUntrusted /u:USERNAME /p:PASSWORD /a:Basic</pre>
<p>Damit konnte ich meine WebApp automatisch auf einen IIS deployen, ohne einen Windows Account anzugeben. Wobei bei Username/Password sicherlich auch ein Windows Account angegeben werden könnte. Wollte ich aber nicht ;)</p>
<p><strong>Fehlen Berechtigungen? Troubleshooting!</strong></p>
<p>WebDeploy zum Laufen zu bekommen kann etwas nervig werden. Daher hier noch ein paar Tipps:</p>
<p>Wurde der Management Service gestartet und erlaubt er Remote Connections? Dürfen überhaupt IIS Manager sich verbinden?</p>
<p><a href="{{BASE_PATH}}/assets/wp-images/image1690.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb848.png" width="580" height="356"></a> </p>
<p>Sind unter dem Punkt “Management Service Delegation” die entsprechenden Berechtigungen IIS weit gesetzt:</p>
<p><a href="{{BASE_PATH}}/assets/wp-images/image1691.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb849.png" width="581" height="209"></a> </p>
<p>Firewall Regel erstellt?</p>
<p><a href="{{BASE_PATH}}/assets/wp-images/image1685.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb843.png" width="454" height="440"></a> </p>
<p>Prüft es am besten über Visual Studio am Anfang ab. Die Fehlermeldungen sind darüber noch am Hilfreichsten. Danach über die Kommandozeile mit den Parametern experimentieren. Visual Studio kann auch den <a href="http://code-inside.de/blog/2012/11/08/welchen-befehl-verwendet-visual-studio-fr-webdeploy-der-msdeployexec-switch/">Befehl anzeigen der genutzt wird</a>.</p>
