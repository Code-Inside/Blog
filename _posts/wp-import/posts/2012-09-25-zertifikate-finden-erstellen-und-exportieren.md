---
layout: post
title: "Zertifikate finden, erstellen und exportieren"
date: 2012-09-25 22:31
author: robert.muehsig
comments: true
categories: [HowTo]
tags: [Zertifikat]
---
{% include JB/setup %}
<p>Ich hatte in letzter Zeit einige Aufgaben erledigt, wo unbedingt Zertifikate benötigt werden. Darunter gehörte unter anderem das Signieren von Assemblies, ClickOnce Installern, SSL Zertifikate hinzufügen und mit Azure rumexperimentieren.</p> <p>Da ich nicht regelmäßig damit arbeite nun mal ein kurzer Blogpost wie man (Test-) Zertifikate erstellt, diese managed und wie man diese auch wieder Exportieren kann. Natürlich beziehe ich mich hierbei auf Windows und ich mache das aus der Sicht eines .NET Entwicklers – wie das auf Linux und co. aussieht: Keine Ahnung. Ich hoffe auch, dass die Angaben soweit stimmen – ich bin kein Vollzeit Admin, welcher sich nur mit Zertifikaten rumschlägt. Für die Entwicklung hat es jedenfalls gereicht ;)</p> <p><strong>(Test-) Zertifikate erstellen über den IIS</strong></p> <p>Zertifkate kann man im Windows über mehrere Wege erstellen und verwalten. Insbesondere der IIS bietet alles was man im Zusammenhang mit Zertifikaten benötigt.</p> <p>Wir wollen zu Entwicklungszwecken ein eigenes Zertifikat erstellen:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1584.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb745.png" width="594" height="277"></a> </p> <p>Dafür einfach nach dem Klick einen Namen eingeben und den Zertifikatsstore wählen (es gibt nur Personal oder Computer – kommen wir dann noch drauf)</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1585.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb746.png" width="558" height="436"></a></p> <p>Danach wurde das Zertifikat erstellt und wir sehen es direkt im IIS und könnten es nun einer Seite zuordnen. </p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1586.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb747.png" width="609" height="422"></a> </p> <p>Weitere Aktionen kann man nun im Kontextmenü anstoßen:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1587.png"><img title="image" style="display: inline" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb748.png" width="348" height="308"></a></p> <p><strong>Vielleicht einer der häufigsten Aufgaben: Das Zertifikat exportieren.</strong></p> <p>Beim Exportieren wird ein .PFX erzeugt, welche u.A. auch den privaten Key enthält. <strong>D.h. diese Dateien sind sensibel und sollten unter keinen Umständen in die falschen Hände geraten wenn es um “echte” Zertifikate geht.</strong> Die .PFX ist über ein Passwort gesichert, welches ihr beim Exportieren mit angebt:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1588.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb749.png" width="240" height="220"></a> </p> <p>Danach kann das Zertifikat auf einen anderen Rechner übertragen werden oder auf dem System für andere Zwecke genutzt werden.</p> <p><strong>Anderer Weg: Über die Microsoft Management Console Zertifikate administrieren.</strong></p> <p>Wer kein IIS zur Hand hat oder ein mächtigeres Tool sucht, der ist bei der MMC richtig. Es gibt einen so genannten “certmgr.msc” (die Anwendung wird erst angezeigt wenn man alles eingetippt hat).</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1589.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb750.png" width="468" height="180"></a> </p> <p></p> <p></p> <p></p> <p></p> <p>Allerdings gibt es hier einen Haken: Dieser Manager zeigt nur die Zertifikate an, welche dem aktuellen Nutzer zugeordnet sind. Im IIS Beispiel haben wir das Zertifikat auch dem “Personal” Store hinzugefügt. Allerdings kann es auch Sinn machen das Zertifikat für den kompletten Rechner zu hinterlegen, daher lieber direkt in die MMC gehen und selbst die Snap-Ins hinzufügen:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1590.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb751.png" width="480" height="130"></a> </p> <p>&nbsp;<a href="{{BASE_PATH}}/assets/wp-images/image1591.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb752.png" width="583" height="338"></a> </p> <p>Hier sehen wir u.A. auch unser&nbsp; vorhin angelegtes Zertifikat:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1592.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb753.png" width="602" height="133"></a> </p> <p>Natürlich kann man hier die Zertifikate auch Exportieren, allerdings mit mehr Optionen: Entweder mit privaten Keys oder ohne und dazu noch einige weiteren Einstellungen, welche mir jetzt aber nix gesagt haben ;)</p> <p>Grundsätzlich:</p> <p>Mit privaten Keys kommt ein .PFX heraus.</p> <p>Ohne private Keys kommt ein .CER heraus.</p> <p><strong>Zertifikate über die Powershell managen:</strong></p> <p>Ohne GUI kommt man natürlich auch zu den Zertifikaten und zwar über die Powershell:</p> <p>Über “cd cert:” wechselt man in den Zertifikatsstore und kann sich dort wie in einem Filesystem navigieren.</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1593.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb754.png" width="464" height="777"></a> </p> <p>Natürlich kann man die Zertifkate auch Filtern oder Exportieren – die Powershell hat da ja recht viele Möglichkeiten. Unter anderem kann man alle Zertifikate mit privatem Key <a href="http://powershell.com/cs/blogs/tips/archive/2009/10/20/exporting-certificate-with-private-key.aspx">über dieses Script exportieren</a>:</p> <p><em>dir cert:\currentuser\my | <br>Where-Object { $_.hasPrivateKey } | <br>Foreach-Object { [system.IO.file]::WriteAllBytes(<br>"$home\$($_.thumbprint).pfx", <br>($_.Export('PFX', 'secret')) ) }</em> <p><strong>Über die CMD Zertifikate erstellen</strong></p> <p>Über das Tool <a href="http://msdn.microsoft.com/en-us/library/bfsktky3.aspx">MakeCert.exe</a> (welches bei der Visual Studio Installation mit dabei ist bzw. im Windows SDK enthalten ist) lassen sich auch Zertifkate über die Kommandezeile erstellen.</p> <p><strong>Finden, suchen, exportieren – Grundlagen gelegt</strong></p> <p>Mit den Basics sollten man wenigstens die einfachsten Tools kennen um mit Zertifikaten zu arbeiten. In einem kommenden Blogpost gehe (hoffentlich halte ich jetzt mein Versprechen) auf das Signieren von Assemblies ein :)</p>
