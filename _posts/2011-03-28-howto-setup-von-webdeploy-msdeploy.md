---
layout: post
title: "HowTo: Setup von WebDeploy / MSDeploy"
date: 2011-03-28 00:49
author: robert.muehsig
comments: true
categories: [HowTo]
tags: [HowTo, MSDeploy, WebDeploy]
---
{% include JB/setup %}
<p><a href="{{BASE_PATH}}/assets/wp-images/image1217.png"><img style="border-bottom: 0px; border-left: 0px; margin: 0px 10px 0px 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" align="left" src="{{BASE_PATH}}/assets/wp-images/image_thumb397.png" width="192" height="135" /></a> </p>  <p>Ich hab vor einer ganzen Weile bereits mal über MSDeploy gesprochen. Dort ging es darum, wie man MSDeploy mit in den Buildprozess einbindet. Nur sehr kurz ging ich auch die Serverkonfiguration ein. Das will ich jetzt ändern, da MSDeploy oder WebDeploy recht zickig ist. Wie kann man also MSDeploy/WebDeploy einrichten?</p> <!--more-->  <p><strong>Grundvoraussetzungen</strong></p>  <p>Ich gehe mal davon aus, dass ein IIS7 oder besser vorliegt. Dort kann man auch recht einfach das Web Deployment Tool über den <a href="http://www.microsoft.com/web/downloads/platform.aspx">Web Platform Installer</a> nachinstallieren - <u>Standardmäßig ist er nicht mit dabei</u> (jedenfalls Stand heute).</p>  <p><strong>Runderladen:</strong> <a href="http://www.iis.net/download/webdeploy">Web Deploy Download</a></p>  <p><strong>Windows Dienste</strong></p>  <p>Für das Webdeploy gibt es zwei wichtige Windows Dienste, welche laufen müssen:</p>  <ul>   <li>Web Deployment Agent Service</li>    <li>Web Management Service</li> </ul>  <p><a href="{{BASE_PATH}}/assets/wp-images/image1218.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb398.png" width="441" height="68" /></a> </p>  <p>Über CMD starten geht auch:</p>  <ul>   <li>net start msdepsvc</li>    <li>net start wmsvc</li> </ul>  <p><strong>IIS Konfigurieren: Management Service</strong></p>  <p>Einer der wichtigsten Punkte für die Konfiguration ist in der "Feature View” der "Management Service”:</p>  <p><a href="{{BASE_PATH}}/assets/wp-images/image1219.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb399.png" width="244" height="136" /></a> </p>  <p>Dort müssen wir sicherstellen, dass "Enable Remote Connection&quot; angehakt ist:</p>  <p><a href="{{BASE_PATH}}/assets/wp-images/image1220.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb400.png" width="425" height="150" /></a> </p>  <p>Man muss den Dienst kurz anhalten um die Einstellungen zu tätigen - aber nicht vergesse den Dienst auch wieder zu starten ;)</p>  <p><strong>Eine weitere IIS Einstellung muss gemacht werden: Management Service Delegation</strong></p>  <p>Unter dem Punkt "Management Service Delegation” muss noch eine Einstellung gemacht werden:</p>  <p><a href="{{BASE_PATH}}/assets/wp-images/image1221.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb401.png" width="244" height="201" /></a> </p>  <p>Über "Edit Feature Settings” müssen alle Administratoren noch zugelassen werden - sprich: <strong>Die erste Checkbox markieren!</strong></p>  <p><a href="{{BASE_PATH}}/assets/wp-images/image1222.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb402.png" width="449" height="219" /></a> </p>  <p><strong>Firewall freischalten</strong></p>  <p>MSDeploy hört auf den TCP <strong>Port "8172”</strong> - den kann man unter dem "Management Service” Punkt auch ändern:</p>  <p><a href="{{BASE_PATH}}/assets/wp-images/image1223.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb403.png" width="385" height="218" /></a> </p>  <p>Entweder man fügt den Port manuell in der Firewalleinstellung hinzu oder benutzt diesen <strong>CMD Aufruf</strong>:</p>  <p>netsh firewall add portopening TCP 8172 WdeployAgent</p>  <p><strong>Website anlegen</strong></p>  <p>Soweit ich weiß, muss im IIS bereits eine Web Site (das unter "Sites”) eingerichtet sein, da das Webdeploy dies nicht automatisch anlegt - ich kann mich aber auch täuschen. Jedenfalls ging es bei mir nur, wenn ich die Web Site vorher schon angelegt hatte.</p>  <p>In meinem Beispiel hatte ich die Web Site "Test” genannt und den AppPool auf .NET 4.0 umgestellt (ansonsten läuft man in einen Fehler, wenn die WebApp das braucht!)</p>  <p><strong>Deployen!</strong></p>  <p><a href="{{BASE_PATH}}/assets/wp-images/image1224.png"><img style="border-bottom: 0px; border-left: 0px; margin: 0px 10px 0px 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" align="left" src="{{BASE_PATH}}/assets/wp-images/image_thumb404.png" width="253" height="340" /></a> </p>  <p>So kann der Visual Studio Publish Screen aussehn. Bei Service URL reicht auch die IP Adresse!</p>  <p>Bei "Site/application” habe ich nur Test gemacht - damit wird es direkt bei der Web Site deployed. Ich könnte jedoch auch noch Unterordner angeben oder wenn ich "Mark as IIS app” anklicke würde er mir Web Applications unterhalb der Web Site erstellen (automatisch).</p>  <p>&#160;</p>  <p>&#160;</p>  <p>&#160;</p>  <p><strong>Für Web Hoster</strong></p>  <p>Wer das richtig professionell (und nicht mit Admin-Accounts rumspielen will) machen möchte, den lege ich <a href="http://learn.iis.net/page.aspx/516/configure-the-web-deployment-handler/">diesen Link ans Herz</a>. Dort geht es darum, wie man bestimmten Nutzern, bestimmte Rechte einräumt.</p>  <p><strong>Links</strong></p>  <p>Wie gesagt: Manchmal ist das Web Deploy oder MS Deploy zickig. Beide Begrifflichkeiten finden sich im Netz.</p>  <p>Größte Ressource war <a href="http://weblogs.asp.net/scottgu/archive/2010/09/13/automating-deployment-with-microsoft-web-deploy.aspx">ScottGus Post</a> und ein <a href="http://blogs.iis.net/kateroh/archive/2009/06/05/troubleshooting-common-msdeploy-issues.aspx">Troubleshooting Post</a>.</p>
