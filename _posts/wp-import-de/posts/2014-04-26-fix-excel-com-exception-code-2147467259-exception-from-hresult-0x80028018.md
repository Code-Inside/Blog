---
layout: post
title: "Fix: Excel COM Exception Code –2147467259 & Exception from HRESULT 0x80028018"
date: 2014-04-26 13:14
author: robert.muehsig
comments: true
categories: [Fix]
tags: [COM, Excel]
language: de
---
{% include JB/setup %}
<p>Wer diesen Blogpost über eine Suchmaschine gefunden hat der befindet sich vermutlich gerade in der COM Hölle von Office Addins. <h3>Fehlermeldung:</h3> <p>Hier geht es um einen Fehler, der nicht bei allen Maschinen auftrat, sondern nur unter bestimmten Umständen. <p>Beim Zugriff über <a href="http://netoffice.codeplex.com/">NetOffice</a> auf die aktive Zelle bekam ich folgende Exception: <p><em>Code:-2147467259 Message:See inner exception(s) for details.</em> <p><em>&nbsp; -&gt; Ein Aufrufziel hat einen Ausnahmefehler verursacht.</em> <p><em>&nbsp;&nbsp;&nbsp; -&gt; Ausnahme von HRESULT: 0x800A03EC</em> <p><em> Callstack:&nbsp;&nbsp; bei System.RuntimeType.InvokeDispMethod(String name, BindingFlags invokeAttr, Object target, Object[] args, Boolean[] byrefModifiers, Int32 culture, String[] namedParameters)</em> <p><em>&nbsp;&nbsp; bei System.RuntimeType.InvokeMember(String name, BindingFlags bindingFlags, Binder binder, Object target, Object[] providedArgs, ParameterModifier[] modifiers, CultureInfo culture, String[] namedParams)</em> <p><em>&nbsp;&nbsp; bei NetOffice.Invoker.PropertySet(COMObject comObject, String name, Object[] value)&nbsp;&nbsp; bei NetOffice.Invoker.PropertySet(COMObject comObject, String name, Object[] value)</em> <p>Als der Code etwas umstruktuiert wurde bekam ich dann diese Fehlermeldung: <p><em>error (Old format or invalid type library. (Exception from HRESULT: 0x80028018 (TYPE_E_INVDATAREAD)))</em> <p>Die zweite Fehlermeldung führte mich zu <a href="http://stackoverflow.com/questions/5180713/old-format-or-invalid-type-library-exception-from-hresult-0x80028018-type-e">diesem Stackoverflow Thread</a> der letztendlich zu diesem <a href="http://stackoverflow.com/questions/8263130/microsoft-office-interop-excel-doesnt-work-on-64-bit/8274888#8274888">führte</a>. <h3>Ursache:</h3> <p>Ich hatte auf einem de-CH Windows 7 ein en-US Office 2010 installiert. Bei dem Office fehlte aber das de-CH Sprachpaket. Scheinbar ist dies ein <a href="http://support.microsoft.com/kb/320369">bekannter Bug von Office</a> – der auch noch mit 2010 und evtl. auch 2013 auftritt.  <p>Im <a href="http://stackoverflow.com/questions/8263130/microsoft-office-interop-excel-doesnt-work-on-64-bit/8274888#8274888">letzten Thread</a> ist das Problem gut zusammengefasst: <p><em>After digging the internet I found out that there is a bug in Microsoft Interop with COM objects (at least with my case which is MS Excel 2010).</em> <p><em>The bug is that .NET checks that your thread (C# or VB code) localization is suitable to MS Excel localization you installed earlier, and if not it tells that the <code>Microsoft.Office.Interop</code> library is old or invalid.</em> <p><em>Your thread localization is derived from your computer regional settings (from the control panel --&gt; regional and language)</em> <h3>Workaround:</h3> <p>Variante a) Sprachpakete des Systems nachinstallieren.</p> <p>Variante b) kurz vor dem Aufruf der Excel Methode die Culture des Threads auf “en-US” stellen.</p> <p>Da mich dieser Wahnsinn etwas Zeit gekostet hat, wollte ich es für die Nachwelt hier reinstellen. Und da behaupten manche tatsächlich das Webentwicklung schwierig sei wegen ein paar Browsern. Desktop… Office… puh…</p>
