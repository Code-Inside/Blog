---
layout: post
title: "PowerShell SnapIns vs. Modules"
date: 2013-02-09 18:37
author: robert.muehsig
comments: true
categories: [Allgemein, HowTo]
tags: [Modules, Powershell, Snapins]
---
<p>Die Powershell hat zwei Varianten wie man CmdLet´s oder Provider nachrüsten kann: SnapIns und Modules. Aber was ist der Unterschied?</p> <p><strong>TL;DR:</strong></p> <table cellspacing="0" cellpadding="2" width="403" border="0"> <tbody> <tr> <td valign="top" width="201"><strong>Snapins</strong></td> <td valign="top" width="200"><strong>Modules</strong></td></tr> <tr> <td valign="top" width="201">PS 1.0 Variante – alt.</td> <td valign="top" width="200">Mit PS 2.0 eingeführt</td></tr> <tr> <td valign="top" width="201">Definiert in Assemblies</td> <td valign="top" width="200">Definiert in Assemblies oder in Scripts</td></tr> <tr> <td valign="top" width="201">Komplexes Deployment via installutil</td> <td valign="top" width="200">Module im Dateisystem</td></tr></tbody></table> <h2>&nbsp;</h2> <h2>Snapins: Die alte Variante</h2> <p>Snapins (wie z.B. in Windows Server 2008 Zeiten das WebAdministration PSSnapin) sind die alte Variante, welche in der ersten Version der Powershell genutzt werden konnte. Nachteil an dieser Variante war:</p> <p>-&nbsp; die PsSnapins müssen in einer .NET Sprache geschrieben sein und als Assembly vorliegen<br>&nbsp;&nbsp;&nbsp; (in der MSDN gibt es auch <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms714437(v=vs.85).aspx">Sample Code zum Erstellen von PSSnapIns</a>)<br>- diese Assemblies mussten über <a href="http://msdn.microsoft.com/en-us/library/50614e95(v=vs.110).aspx">installutil.exe</a> installiert werden</p> <p><strong>Welche PSSnapins sind auf meinem System installiert?</strong></p> <p>Über das CmdLet “Get-PSSnapin –registered” bekommt man alle registrierten Snapins:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1766.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb920.png" width="538" height="82"></a></p> <p><strong>Wo werden die PSSnapins gespeichert? Natürlich in der Registry!</strong></p> <p>Die Registrierung der PSSnapins erfolgte in der Registry:</p> <p><em>Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PowerShell\1\PowerShellSnapIns\</em></p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1767.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb921.png" width="530" height="193"></a></p> <p><strong>Welche CmdLets sind für das Verwalten der PSSnapins da?</strong></p> <p><em>Get-PSSnapIn –registered</em>: Liefert alle verfügbaren PSSnapIns <br><em>Add-PSSnapIn [name]: </em>Fügt das PSSnapIn der PowerShell Session an <br><em>Get-Command –pssnapin [name]</em>: Gibt CmdLets zum PSSnapin aus (muss vorher über Add in die Session geholt werden)</p> <p><strong>Alles in allem sollte man keine Snapins mehr erstellen</strong> – jedoch gibt es sie noch, daher die erklärenden Worte.</p> <h2>PowerShell Module – die neue Welt.</h2> <p>&nbsp;</p> <p>Die Module wurden mit der zweiten Version der PowerShell eingeführt und sind um einiges reicher an Möglichkeiten und verlangen auch keine Registrierung in der Registry.</p> <p><strong>Wo sind die Module gespeichert?</strong></p> <p>Wenn über <a href="http://technet.microsoft.com/en-us/library/hh849725.aspx">Import-Module</a> einfach nur ein Modul über den Modulnamen importiert werden soll, wird im Standardfall in den Ordnern geschaut, welche in der Umgebungsvariable “<strong>$env:psmodulepath</strong>” definiert sind:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1768.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb922.png" width="600" height="60"></a></p> <p>Ansonsten kann man bei <a href="http://technet.microsoft.com/en-us/library/hh849725.aspx">Import-Module</a> <a href="http://blogs.technet.com/b/heyscriptingguy/archive/2012/11/08/powertip-import-a-powershell-module-from-a-shared-location.aspx">auch direkte Pfade zu Powershell Modulen</a> angeben.</p> <p>Anmerkung: In Powershell 3.0 sind alle verfügbaren Module automatisch in der Session aktiviert und müssen nicht über Import-Module in die Session geladen werden.</p> <p><strong>Welche Module sind denn “installiert”?</strong></p> <p>Über “Get-Module –ListAvailable” bekommt man die Auflistung:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1769.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb923.png" width="583" height="273"></a></p> <p><strong>Was ist denn der “ModuleType”?</strong></p> <p>Anders als bei PSSnapIns können Module entweder aus simplen Scripts bestehen, einem Workflow, einer Assembly oder einem Manifest. Dazu ist der ModuleType definiert:</p> <p><em>Binary<br>A module whose members are defined within an assembly (<code>.dll</code> extension), such as a snap-in or a class library that contains cmdlet classes. This field is introduced in Windows PowerShell 2.0.</em></p> <p><em>Cim<br>A cmdlets-over-objects module (<code>.cdxml</code> extension).</em></p> <p><em>Manifest<br>A module that is defined by a module manifest file (<code>.psd1</code> extension) whose <code>ModulesToProcess</code> key is empty. This field is introduced in Windows PowerShell 2.0.</em></p> <p><em>Script<br>A module whose members are defined within a script module file (<code>.psm1</code> extension). This field is introduced in Windows PowerShell 2.0.</em></p> <p><em>Workflow<br>A workflow module (<code>.xaml</code> extension).</em></p> <p>Aus diesem <a href="http://msdn.microsoft.com/en-us/library/system.management.automation.moduletype(v=vs.85).aspx">MSDN Arikel</a>.</p> <p><strong>Wie sieht so ein Modul aus? Schauen wir uns mal das “WebAdministration” Modul an</strong></p> <p>Das “WebAdministration”-Modul (um den IIS zu verwalten) findet sich im normalen “WindowsPowershell” Ordner und enthält ein paar Dateien:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image1770.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb924.png" width="546" height="269"></a></p> <p>Die .<strong>psd1</strong> Datei ist das <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd878324(v=vs.85).aspx">Modul Manifest</a> und eigentlich das wichtigste:</p><pre class="brush: csharp; auto-links: true; collapse: false; first-line: 1; gutter: true; html-script: false; light: false; ruler: false; smart-tabs: true; tab-size: 4; toolbar: true;">@{
GUID='{13c15630-959c-49e4-a977-758c5cc93408}'
Author='Microsoft Corporation'
CompanyName='Microsoft Corporation'
Copyright='© Microsoft Corporation. All rights reserved.'
ModuleVersion='1.0.0.0'
PowerShellVersion='3.0'
CLRVersion='4.0'
TypesToProcess='iisprovider.types.ps1xml'
FormatsToProcess='iisprovider.format.ps1xml'
NestedModules='Microsoft.IIS.PowerShell.Provider.dll'
RequiredAssemblies='Microsoft.IIS.PowerShell.Framework.dll'
AliasesToExport='Begin-WebCommitDelay','End-WebCommitDelay'
HelpInfoUri="http://go.microsoft.com/fwlink/?LinkID=216903"
}</pre>
<p>Die eigentliche Funktionalität des Powershell Moduls liegt in der Microsoft.IIS.PowerShell.Provider.dll im <a href="http://code-inside.de/blog/2013/02/07/mit-net-4-0-gibt-es-einen-neuen-gac/">CLR 4.0 GAC</a>.</p>
<p><strong>Wie schreibe ich ein Windows Powershell Modul?</strong></p>
<p>Grundsätzlich ist Entwicklung von .NET basierten Powershell Modulen ganz ähnlich von alten Snapins: <a href="http://blogs.msdn.com/b/saveenr/archive/2010/03/08/how-to-create-a-powershell-2-0-module-and-cmdlet-with-visual-studio-2010-screencast-included.aspx">How to Create a Powershell 2.0 Module and Cmdlet with Visual Studio 2010 (Screencast included)</a></p>
<p>Eine gute Referenz sind auch die <a href="https://github.com/WindowsAzure/azure-sdk-tools/tree/master/WindowsAzurePowershell"><strong>Windows Azure CmdLets</strong></a>.</p>
<p><strong>Wie bekomme ich neue Module registriert?</strong></p>
<p>Die CmdLets zum Registrieren eines Modules sind ähnlich wie bei den Snapins:</p><pre class="brush: csharp; auto-links: true; collapse: false; first-line: 1; gutter: true; html-script: false; light: false; ruler: false; smart-tabs: true; tab-size: 4; toolbar: true;">Get-Module -ListAvailable
Import-Module name
Get-Command -module name</pre>
